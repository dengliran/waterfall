!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).waterfall=i()}(this,function(){"use strict";var s={containerClass:"",container:"",items:[],itemsClass:".waterfall-item",itemsAnimate:!0,fallEndCallback:function(){}};function e(t,i){return this instanceof e?this.init(t,i):new e(t,i)}function r(t,i){return"max"==t?Math.max.apply(Math,i):"min"==t?Math.min.apply(Math,i):void 0}return e.prototype.init=function(t,i){return this.imgLoad=0,this.imgLoadWT=100,this.itemWidth=0,this.containerWidth=0,this.firstRow=[],"string"!=typeof t&&(i=t,t=void 0),this.configure(i),t?s.container=document.querySelector(t):!s.container&&s.containerClass&&(s.container=document.querySelector(s.containerClass)),s.items.length||(s.items=document.querySelectorAll(s.itemsClass)),this.initDomStyle().setContainerWidth().imgLoadIng().checkImgloadstatus().bindEvent(),this},e.prototype.configure=function(t){var i,e;for(i in t)void 0!==(e=t[i])&&t.hasOwnProperty(i)&&(s[i]=e);return this},e.prototype.initDomStyle=function(){return s.container.style.position="relative",s.container.style.margin="0 auto",s.items.forEach(function(t){t.style.position="absolute",s.itemsAnimate&&t.setAttribute("style",t.getAttribute("style")+"\n        transition-property: top, left;\n        transition-duration: 400ms;\n        transition-timing-function: ease-out")}),this.itemWidth=s.items[0].offsetWidth,this},e.prototype.setContainerWidth=function(){return s.container.style.width="auto",this.containerWidth=s.container.offsetWidth,this.colNum=Math.floor(this.containerWidth/this.itemWidth),s.container.style.width=this.colNum*this.itemWidth+"px",this},e.prototype.imgLoadIng=function(){var n=this;return s.items.forEach(function(t){var i=t.getElementsByTagName("img")[0],e=new Image;e.src=i.getAttribute("src"),e.complete?n.imgLoad++:i.onload=function(){n.imgLoad++}}),this},e.prototype.checkImgloadstatus=function(){var t=this;return this._setItemPosition(),this.imgLoad<s.items.length&&this.imgLoadWT<3e3?setTimeout(function(){t.imgLoadWT+=100,t.checkImgloadstatus()},this.imgLoadWT):this.imgLoad===s.items.length?this._setItemPosition():(this._setItemPosition(),console.error("waterfall_ERR: "+(s.items.length-this.imgLoad)+"_TIMED_OUT")),this},e.prototype._setItemPosition=function(){var o=this;return this.firstRow=[],s.items.forEach(function(t,i){var e,n;i<o.colNum?(o.firstRow.push(parseInt(t.offsetHeight)),t.style.top=0,t.style.left=i*o.itemWidth+"px",t.style.position="absolute"):(n=function(t,i){for(var e=0;e<i.length;e++)if(i[e]===t)return e}(e=r("min",o.firstRow),o.firstRow),t.style.top=e+"px",t.style.left=o.itemWidth*n+"px",t.style.position="absolute",o.firstRow[n]+=parseInt(t.offsetHeight))}),this._setContainerHeight(),s.fallEndCallback(),this},e.prototype._setContainerHeight=function(){var t=r("max",this.firstRow);return s.container.height=t+"px",this},e.prototype.bindEvent=function(){var t=this,i=!0;return window.onresize=function(){i&&(t.setContainerWidth()._setItemPosition(),i=!1,setTimeout(function(){i=!0},600))},this},e});
